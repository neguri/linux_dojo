
## 프로세스 추적

### top 명령어
> top 명령어를 입력 후 , 옵션을 사용 할 수 있음  
spacebar : 화면을 즉시 업데이트 한다  
M : 현재 상주 메모리 사용량에 따라 분류한다  
T : 전체 누적 CPU 사용량에 따라 분류한다.  
P : 현재 CPU 사용량(default)에 따라 분류한다.  
u : 하나의 사용자 pid만 선택해서 보여준다.  
f : 다른 자료의 통계 자료가 나타나게 한다 (보고 싶은 항목을 선택 후 다시 화면으로 돌아가면 그 정보가 나오게 됨)  
? : 도움말을 보여준다.  
(비슷한 기능으로 atop 과 htop 이 있음)


### lsot
> 터미널에서 __lsof__ 라고 입력해 보자. 정말 많은 출력이 나온다. (열려 있는 모든 파일(네트워크 리소스,동적 라이브러리, 파이프)을 보여준다.)
  COMMAND: 파일 디스크립터를 보유하는 프로세스 이름
  PID : 프로세스 ID  
  USER : 프로세스를 실행하는 사용자  
  FD: 파일의 목적 혹은 파일 기술자(?)
  TYPE: 파일 타입  
  DEVICE: 장치의 주 번호, 부 번호  
  SIZE: 파일의 크기  
  NODE: 파일의 아이노드 숫자  
  NAME: 파일 이름  
  
  
  > __lsof /usr__ : usr에 열려 있는 파일만  
  __lsof -p pid__ : 특정 pid만 보고자 할때  
  
  
 ### strace
 > 프로세스가 만든 모든 시스템 콜을 출력한다.  
 __strace cat /dev/null__ 
 
 ### lstrace
 > 공유 라이브러리 콜을 추적한다. ltrace는 커널 레벨에서는 어떤 것도 추적하지 않는다. 
 
 
 ### thread
 
 > __ps m__ 이렇게 하면 thread 정보까지 같이 나온다. pid 아래 몇개의 thread가 수행되고 있는지 보여준다.
  
### CPU 시간 측정
> __top -p pid__ 로 특정 프로세스의 시간별 변화를 확인 할 수 있다. 
__/usr/bin/time ls__ 를 하면 ls가 종료된 후 ls 가 얼마만큼의 cpu 시간을 사용하는지 확인 할 수 있다.  


### 프로세스 우선 순위 조정
> 커널은 특정 프로세스에 다른 프로세스보다 더 많은 CPU 시간을 부여하기 위해서 우선 순위를 관리한다. __ps -l__ 로도 볼 수 있지만 __top__ 명령이 더 보기 좋다.  
top 명령에서 'PR' 열에 커널의 현재 일정 우선 순위를 보여주게 되는데, 값이 크면 클 수록 커널은 CPU를 덜 할당해 준다. 그리고 프로그램이 실행 되는 동안 해당 프로세스가 소모하는 CPU시간에 따라
우선 순위는 자주 변경된다.   
NI(nice value)도 자주 나오는 값인데, 커널은 우선순위에 이 NI를 추가해서 해당 프로세스가 보유할 다음 시간대를 결정 한다. 기본 NI 값은 0 이다. 그리고 __renice 20 pid__ 와 같이 변경 할 수 있고, NI를 음수로 변경할 수도 있지만 좋은 방법은 아니다. 

### load average
> __uptime__ 명령을 통해서 load average를 확인할 수 있다. 값은 %를 의미하므로 값이 1 이면 100% 인데, CPU의 모든 자원을 사용하고 있다는 뜻이다. 그런데 코어가 여러개이면 코어 갯수로 나눠야 한다. 코어가 2개인데, load average가 1 이면 CPU 하나만큼만 사용하고 있다는 의미이다.  

### vmstat
> 커널이 페이지를 얼마나 자주 교환하는지, CPU가 얼마나 바쁘게 활동 중인지, I/O가 어떻게 활용되는지 보여준다.(
__vmstat 2__ 라고 하면 2초 간격으로 통계를 보여주게 됨)  

### iostat
> vmstats는 일반적인 I/O 통계를 보여주게 되는데, vmstat -d 로 하면 너무 많은 정보를 보여준다. 그래서 __iostat__ 를 사용해서 I/O 상태만 보여주는 __iostat__ 를 사용한다.  
> vmstat 와 비슷하게 시간 간격을 부여해서 모니터링 할 수 있으며, __iostat -p ALL__ 명령을 통해 전체 파티션 모두를 확인 할 수 있다. 


### pidstat

> top나 iotop은 특정 프로세스를 모니터링하게 되는데, __pidstat__ 는 이미 제거된 프로세스 정보도 볼 수 있다. 
